
#-- hesssian:

H_1_1 = [ 
              7.1542384536e-01   2.4561200123e-13   2.9375157616e-11   
              1.7566660084e-12   4.8044126428e-06  -2.3500750926e-12   
              2.6284912792e-13  -6.4509718513e-14   4.3583098862e-01    ] ; 
H_1_2 = [ 
             -3.5771192271e-01  -1.5493641624e-13  -2.6159545113e-01   
             -5.8738284723e-12  -2.4023802019e-06   1.1750375463e-12   
             -1.8295966242e-01  -5.6271902388e-14  -2.1791549422e-01    ] ; 
H_1_3 = [ 
             -3.5771192272e-01  -9.0675586097e-14   2.6159545112e-01   
              0.0000000000e+00  -2.4023809761e-06   1.7624246517e-12   
              1.8295966241e-01   1.2078162055e-13  -2.1791549421e-01    ] ; 
H_2_1 = [ 
             -3.5771192323e-01  -5.1553900021e-13  -1.8295967380e-01   
              3.3256646926e-12  -2.4018541662e-06   0.0000000000e+00   
             -2.6159550441e-01   2.4139819541e-12  -2.1791549515e-01    ] ; 
H_2_2 = [ 
              3.9526618448e-01   4.2248326926e-14   2.2227756246e-01   
             -5.8205428228e-13  -4.2992356781e-05   2.9377277746e-12   
              2.2227758306e-01  -1.9773385210e-12   2.0456684703e-01    ] ; 
H_2_3 = [ 
             -3.7554261208e-02   4.7329067352e-13  -3.9317888597e-02   
             -1.1641802814e-12   4.5394385213e-05   1.1750386669e-12   
              3.9317921307e-02  -4.3664343447e-13   1.3348648007e-02    ] ; 
H_3_1 = [ 
             -3.5771192323e-01   1.6932724512e-13   1.8295967380e-01   
             -1.7597403109e-12  -2.4018530674e-06  -1.5274964793e-11   
              2.6159550441e-01  -4.5954169641e-13  -2.1791549515e-01    ] ; 
H_3_2 = [ 
             -3.7554261213e-02   4.8566136891e-14   3.9317888594e-02   
              2.3548958123e-12   4.5394385109e-05   4.6998868498e-12   
             -3.9317921311e-02   5.7487429321e-13   1.3348648008e-02    ] ; 
H_3_3 = [ 
              3.9526618447e-01  -2.1789338090e-13  -2.2227756246e-01   
             -5.8738284723e-12  -4.2992357774e-05   0.0000000000e+00   
             -2.2227758306e-01  -1.1533259551e-13   2.0456684703e-01    ] ; 

#DIPOLE DERIVATIVE
 dip_1  = [ 
             -3.8711467340e-01  -2.7648127391e-12  -8.4894438679e-11  
              6.0678172600e-12  -8.7133408572e-01  -1.3218857234e-11  
              7.3466343153e-12  -8.7779411646e-13  -3.2940770427e-01  ] ; 
 dip_2  = [   
              1.9355733701e-01   5.8608535544e-13  -1.0379397065e-01  
              1.2407199770e-11   4.3566704454e-01  -1.0575085787e-11  
             -1.7705654141e-01  -3.4600417510e-12   1.6470385017e-01  ] ; 
 dip_3  = [   
	      1.9355733699e-01   2.7794794633e-12   1.0379397063e-01  
             -6.5366299271e-12   4.3566704454e-01  -3.4369028808e-11  
              1.7705654142e-01   3.2043409096e-12   1.6470385019e-01  ] ; 




#---
# assemble  Hessian
Hess = [  H_1_1 ,  H_1_2 ,  H_1_3 ; 
          H_2_1 ,  H_2_2 ,  H_2_3 ;
          H_3_1 ,  H_3_2 ,  H_3_3   ]  ;

dip = [ dip_1 ;  dip_2 ;  dip_3 ];
         

mH= 1.00794 ;  mD =2.014 ;   mO = 16.00   ;
mass (1:3) =   mO ; 
mass (4:9) =   mH ; 
mass *= amu;


mwHess =  Hess ./sqrt(mass' *mass) 
mwHess =  0.5*(mwHess  + mwHess ')    # symmetrize it
[cc,ee ] = eig(mwHess) ;
 ee=diag(ee) ;
 freqs_cm  = sqrt(ee(7:9))/cm2Eh  


# normal modes:
 mm = 1./sqrt(mass)'     # column vector
 cc =  mm .*  cc 
 cc2 =  cc ./ sqrt(diag(cc'  *cc))'  ;
 cc2=  cc2(:,7:9) ;  

#-----
#   u  =  u0  +   sum_k * du(x)/dx *dx/dQ_k     
#   dQ =  dx/dQ *dQ 

m_reduced = [   1.0898   1.0386   1.0850 ] 


m_red1 = (mass/amu   .* cc2(:,1)' )  *cc2(:,1)
m_red2 = (mass/amu   .* cc2(:,2)' )  *cc2(:,2)
m_red3 = (mass/amu   .* cc2(:,3)' )  *cc2(:,3)


#--- IR intensities: 
dudq = (cc2(:,1)'*dip) ; du1 = dudq*dudq'
dudq = (cc2(:,2)'*dip) ; du2 = dudq*dudq'
dudq = (cc2(:,3)'*dip) ; du3 = dudq*dudq'
IR = [du1 , du2 ,  du3]  ./ m_reduced 



